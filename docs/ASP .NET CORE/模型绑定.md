---
title: "模型绑定"
excerpt_separator: "<!--more-->"
categories:
  - ASP.NET CORE
tags:
  - FromQuery
  - FromRoute
---

# [模型绑定](https://learn.microsoft.com/zh-cn/aspnet/core/mvc/models/model-binding?view=aspnetcore-9.0)

## [FromQuery]
是 ASP.NET Core 中的一个 参数绑定属性（Attribute），它的作用是明确告诉模型绑定系统：这个参数的值应该从 HTTP 请求的查询字符串（Query String）中获取。

✅ 简单定义  
[FromQuery]
指示框架从 URL 的查询字符串部分（即 ? 后面的部分）绑定参数值。
假设你有这样一个 API：
```csharp
[HttpGet("search")]
public IActionResult SearchPets([FromQuery] string type, [FromQuery] int page = 1)
{
// 业务逻辑
return Ok($"Searching {type} on page {page}");
}
访问 URL：
GET /search?type=dog&page=3
结果：
type = "dog"
page = 3
```
✅ 参数成功从查询字符串中绑定。

✅ FromQuery 的核心作用

作用 说明

---

🔹 明确数据来源 告诉框架：“这个参数的值来自查询字符串”，避免歧义
🔹 提高代码可读性 其他人一眼就知道参数是从 ?xxx=yyy 来的
🔹 支持复杂类型绑定 可用于绑定数组、集合、自定义对象等
🔹 可与其他来源区分 区别于 [FromRoute]、[FromBody]、[FromHeader] 等

✅ 什么时候需要 FromQuery？
✅ 情况 1：可选参数或筛选条件（最常见）

```csharp
[HttpGet]
public IActionResult GetPets([FromQuery] string species, [FromQuery] bool isVaccinated)
{
// GET /pets?species=cat&isVaccinated=true
}
```

适合用于：
搜索
过滤
分页
排序

✅ 情况 2：参数名与路由参数冲突或不清晰

```csharp
[HttpGet("{id}")]
public IActionResult GetPet(int id, [FromQuery] int id) // ❌ 错误！冲突
```

虽然不会这样写，但明确标注来源可以避免混淆。

✅ 情况 3：绑定数组或集合

```csharp
[HttpGet("batch")]
public IActionResult GetPets([FromQuery] int[] ids)
{
// GET /batch?ids=1&ids=2&ids=3
// 或 /batch?ids=1,2,3（取决于配置）
}

输出：ids = [1, 2, 3]
```

✅ 必须用 [FromQuery] 明确指定来源。

✅ 情况 4：绑定复杂对象（查询条件对象）

```csharp
public class PetSearchQuery
{
public string Type { get; set; }
public int? AgeMin { get; set; }
public string Breed { get; set; }
}

[HttpGet("search")]
public IActionResult Search([FromQuery] PetSearchQuery query)
{
// GET /search?type=dog&ageMin=2&breed=labrador
// query.Type = "dog", query.AgeMin = 2, query.Breed = "labrador"
}
```

✅ 这是构建高级搜索 API 的常用方式。

❓ 不写 [FromQuery] 可以吗？

在大多数情况下，可以！

ASP.NET Core 会自动尝试从查询字符串绑定简单类型参数（如 string, int, bool 等）。

比如：

```csharp
[HttpGet]
public IActionResult GetPets(string type, int page)
```

访问 /pets?type=cat&page=2 → 也能正常工作。
但是！推荐写 [FromQuery] 的理由：

理由 说明

---

✅ 显式优于隐式 代码意图更清晰，符合 Clean Code 原则
✅ 团队协作友好 新人一看就知道参数来源
✅ 避免未来问题 如果参数名和路由参数同名，可能出错
✅ 支持工具识别 Swagger、API 文档生成工具能更好识别

✅ 对比其他绑定源

属性 来源 示例

---

[FromQuery] 查询字符串 ?name=john
[FromRoute] 路由参数 /pets/123 → {id}
[FromBody] 请求体（JSON） POST JSON 数据
[FromHeader] 请求头 Authorization: Bearer xxx
[FromForm] 表单数据 application/x-www-form-urlencoded

✅ 总结：[FromQuery] 的作用
明确指定某个参数的值来自 URL 的查询字符串部分（?key=value）。
✔️ 使用场景：
搜索、过滤、分页
接收多个可选参数
绑定数组或集合
提高代码可读性和维护性
📌 建议：
即使不写也能工作，但建议始终使用 [FromQuery]，尤其是在生产项目中，这是一种良好的 API 设计习惯。

如果你想看更多关于模型绑定的技巧（比如自定义查询参数名、数组绑定格式等），我也可以继续补充！ 😊

是的，您的理解完全正确！ 🎯

我们来详细分析这个例子，确认您的判断。

✅ 您的代码

```csharp
[HttpGet("{id}")]
public ActionResult<Pet> GetById(int id, bool dogsOnly)
✅ 您的请求 URL

https://contoso.com/api/pets/2?DogsOnly=true
```

🔍 模型绑定如何工作？

ASP.NET Core 的模型绑定系统会根据 参数名 和 来源优先级 自动尝试从多个来源绑定数据，包括：

1. 路由数据（Route） → {id}
2. 查询字符串（Query） → ?DogsOnly=true
3. 请求体（Body）
4. 请求头（Header）
5. 表单数据（Form）

当没有显式使用 [From...] 特性时，框架会按优先级自动查找。

✅ 参数绑定结果

参数 类型 值 来源 判断依据

---

id int 2 ✅ [FromRoute] 参数名 id 与路由模板 {id} 匹配，从路径 /2 绑定
dogsOnly bool true ✅ [FromQuery] 参数名 dogsOnly 与查询参数 DogsOnly=true 匹配（忽略大小写 + 驼峰/帕斯卡命名自动映射）
🔍 命名匹配说明：
dogsOnly (C# 驼峰命名) 与 DogsOnly (URL 帕斯卡命名) 被 ASP.NET Core 自动匹配，因为模型绑定默认不区分大小写，并支持常见命名约定。

✅ 验证：2 是 [FromRoute]，DogsOnly 是 [FromQuery]

您的说法 是否正确 说明

---

2 是 [FromRoute] ✅ 正确 id 来自路由 {id}
DogsOnly 是 [FromQuery] ✅ 正确 dogsOnly 来自查询字符串 ?DogsOnly=true

💡 更清晰的写法（推荐）

虽然框架能自动绑定，但为了提高代码可读性和维护性，建议显式使用 [From...] 特性：

```csharp
[HttpGet("{id}")]
public ActionResult<Pet> GetById(
[FromRoute] int id,
[FromQuery] bool dogsOnly)
{
// ...
}
```

这样其他开发者一眼就能看出每个参数的来源，避免歧义。

⚠️ 注意事项

1. 大小写不敏感匹配：
   dogsOnly 能匹配 DogsOnly、dogsonly、DOGS_ONLY 等，但建议保持命名一致。

2. 布尔值绑定：
   查询字符串中的 true/false 能正确绑定到 bool 类型。

3. 可选参数：
   如果请求是 /api/pets/2（没有 ?DogsOnly=...），dogsOnly 将使用默认值 false（bool 的默认值）。

如果你想指定默认值：
csharp
bool dogsOnly = false

✅ 总结
是的，您完全正确！
id = 2 来自 路由 → 相当于 [FromRoute]
dogsOnly = true 来自 查询字符串 → 相当于 [FromQuery]

这是 ASP.NET Core 模型绑定的默认行为，它智能地从不同来源绑定参数，无需显式标注（但建议标注以提高可读性）。

📌 官方文档参考：
[https://docs.microsoft.com/zh-cn/aspnet/core/mvc/models/model-binding](https://docs.microsoft.com/zh-cn/aspnet/core/mvc/models/model-binding)
